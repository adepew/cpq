{% extends 'base.html' %}

{% block content %}

	<div class="col-md-6">
		<h1>Salesforce Data Compare</h1>
	</div>

	<div class="col-md-6 text-right">
		<a href="/select-object/{{ job.random_id }}" class="btn btn-info" style="margin-top: 20px;">
			<span class="glyphicon glyphicon-backward" aria-hidden="true"></span>
			&nbsp; Select Another Object
		</a>
		<a href="#" class="btn btn-warning" id="rerunJob" style="margin-top: 20px;">
			Rerun &nbsp;
			<span class="glyphicon glyphicon-repeat" aria-hidden="true"></span>
		</a>
	</div>

	<div class="col-md-12">

		<br/>

		<p>
			And the results are in! The information below displays a comparison of the records between the two orgs, for the selected object and the selected fields.
		</p>

		<hr/>

		<table class="table table-hover table-striped">
			<tr>
				<th><h4>Object</h4></th>
				<td colspan="2">{{ job.object_label }} ({{ job.object_name }})</td>
			</tr>
			<tr>
				<th><h4>Fields</h4></th>
				<td colspan="2">{{ job.fields }}</td>
			</tr>
		</table>

		<br/>

		<table class="table table-hover table-striped">
			<tr>
				<td></td>
				<th><h4>{{ job.sorted_orgs.0.username }}</h4></th>
				<th><h4>{{ job.sorted_orgs.1.username }}</h4></th>
			</tr>
			<tr>
				<th><span data-toggle="tooltip" data-placement="top" title="The number of records that exist in the object"># Records</span></th>
				<td>{{ job.row_count_org_one }}</td>
				<td>{{ job.row_count_org_two }}</td>
			</tr>
			<tr>
				<th><span data-toggle="tooltip" data-placement="top" title="The number of records that exist in one org, and also exists in the other"># Matching Rows</span></th>
				<td>{{ job.matching_rows_count_org_one }}</td>
				<td>{{ job.matching_rows_count_org_two }}</td>
			</tr>
			<tr>
				<th><span data-toggle="tooltip" data-placement="top" title="The number of records that exist in one org, but doesn't exist in the other"># Unmatching Rows</span></th>
				<td>{{ job.unmatching_rows_count_org_one }}</td>
				<td>{{ job.unmatching_rows_count_org_two }}</td>
			</tr>

		</table>

	</div>

{% endblock %}

{% block scripts %}

	<script type="text/javascript">

		$(document).ready(function () {

			// Enable tooltips
			$('[data-toggle="tooltip"]').tooltip()

			// When the rerun job button is clicked
			$('#rerunJob').click(function () {

				$.ajax({
				    url: '/compare-data/{{ job.random_id }}/{{ job.object_id }}/',
				    type: 'get',
				    success: function(resp) 
				    {
				        // Redirect to the loading page
	                	window.location = resp;
				    },
				    failure: function(resp) 
				    { 
						// Return error in a modal
		                updateModal(
		                    'Error Executing Data Compare',
		                    '<div class="alert alert-danger" role="alert">There was an error executing the data compare job.' + resp + '</div>',
		                    true
		                );

		                // Close the modal
		                $('#progressModal').modal();
				    }
				});

			});

		});

	</script>
{% endblock %}