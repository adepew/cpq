{% extends 'base.html' %}

{% block content %}

	<div class="col-md-6">
		<h1>Salesforce Data Compare</h1>
	</div>

	<div class="col-md-6 text-right">
		<a href="/select-object/{{ job.random_id }}" class="btn btn-info" style="margin-top: 20px;">
			<span class="glyphicon glyphicon-backward" aria-hidden="true"></span>
			&nbsp; Select Another Object
		</a>
		<a href="#" class="btn btn-warning" id="rerunJob" style="margin-top: 20px;">
			Rerun &nbsp;
			<span class="glyphicon glyphicon-repeat" aria-hidden="true"></span>
		</a>
	</div>

	<div class="col-md-12">

		<br/>

		<p>
			And the results are in! The information below displays a comparison of the records between the two orgs, for the selected object and the selected fields.
		</p>

		<hr/>

		<table class="table table-hover table-striped">

			<tr>
				<th>Object</th>
				<td colspan="2">{{ job.object_label }} ({{ job.object_name }})</td>
			</tr>
			<tr>
				<th>Fields</th>
				<td colspan="2">{{ job.fields }}</td>
			</tr>
			<tr>
				<td colspan="3"></td>
			</tr>
			<tr>
				<td></td>
				<th>{{ job.sorted_orgs.0.username }}</th>
				<th>{{ job.sorted_orgs.1.username }}</th>
			</tr>
			<tr>
				<th># Records</th>
				<td>{{ job.row_count_org_one }}</td>
				<td>{{ job.row_count_org_two }}</td>
			</tr>
			<tr>
				<th>Matching Rows</th>
				<td colspan="2">{{ job.matching_rows_count }}</td>
			</tr>
			<tr>
				<th>Unmatching Rows</th>
				<td colspan="2">{{ job.unmatching_rows_count }}</td>
			</tr>

		</table>

	</div>

{% endblock %}

{% block scripts %}

	<script type="text/javascript">

		$(document).ready(function () {

			$('#rerunJob').click(function () {

				$.ajax({
				    url: '/compare-data/{{ job.random_id }}/{{ job.object_id }}/',
				    type: 'POST',
				    dataType: 'json',
				    success: function(resp) 
				    {
				        // Redirect to the loading page
	                	window.location = data;
				    },
				    failure: function(resp) 
				    { 
						// Return error in a modal
		                updateModal(
		                    'Error Executing Data Compare',
		                    '<div class="alert alert-danger" role="alert">There was an error executing the data compare job.' + data + '</div>',
		                    true
		                );

		                // Close the modal
		                $('#progressModal').modal();
				    }
				});

			});

		});

	</script>
{% endblock %}