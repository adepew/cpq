{% extends 'base.html' %}

{% block content %}

	<h1>Salesforce Data Compare</h1>

	<p>
		Select an object from the list below and then tick the fields you want to use to compare the data to. It is recommended to only select fields that aren't unique to an Org. Eg. Id and auto-number fields.
	</p>
	<p>
		Note: This will only show objects and fields that exist in both environments.
	</p>

	<hr />

	<div class="col-md-3">
		<h2 class="no-margin">Select Object</h2>
	</div>

	<div class="col-md-6">
		<select class="form-control" id="object-select">
			<option value="">-- Select Option --</option>
			{% for object in job.sorted_objects %}
				<option value="{{ object.api_name }}">{{ object.label }} ({{ object.api_name }})</option>
			{% endfor %}
		</select>
	</div>

	<div class="col-md-12" class="field-select"></div>

	<div class="modal fade" id="progressModal" tabindex="-1" role="dialog" aria-labelledby="progressModalLabel" aria-hidden="true">
		<div class="modal-dialog">
	    	<div class="modal-content">
	      		<div class="modal-header"></div>
	      		<div class="modal-body"></div>
	      		<div class="modal-footer"></div>
	    	</div>
	  	</div>
	</div>

{% endblock %}

{% block scripts %}

	<!-- Generic JS scripts for this page -->	
	<script type="text/javascript" src="/static/js/select-object.js"></script>

	<!-- Cookie scipt for AJAX posts to controller -->
	<script src="/static/js/cookie.js"></script>

	<!-- JS to handle job specific actions -->
	<script type="text/javascript">

		$(document).ready(function () {

			$('#object-select').change(function () {

				if ( $(this).val() != '' ) {

					// Set text for the modal 
					updateModal(
						'Querying fields.',
						'<div>Querying both Orgs to determine matching fields for the selected object.</div><div class="progress"><div class="progress-bar progress-bar-warning progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div></div>',
						false
					);

					// Launch the loading modal
					$('#progressModal').modal();

					// Execute query of fields for the selected object
					$.ajax({
						url: '/get-fields/{{ job.random_id }}/',
						type: 'POST',
						headers: {'X-CSRFToken': getCookie('csrftoken')},
						data: {'object': JSON.stringify($(this).val())},
						success: function(resp) {

					    	check_get_fields_job(resp);
					    },
					    failure: function(resp) {

					    	updateModal(
					    		'Error',
								'<div class="alert alert-danger" role="alert">There was an error deploying your components: ' + resp + '</div>',
								true
							);
					    }
					}); 

				}
				else {

					$('.field-select').hide('slow');
				}

			});

		});

	</script>
{% endblock %}